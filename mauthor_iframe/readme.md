# Internal API

This exploit uses JS functions and variables that are defined in mauthor-iframe that is loaded when any quiz is being done. This exploit can only work if the iframe is loaded

---

## About

The functions and variable defined in mauthor-iframe are used to handle quiz data, by providing questions, storing answers, calculating scores, etc. There are a lot of them, and most of the time they have to be reverse-engineered because the JS code is minified. The good part is that it isn't obscured, meaning that most of the functionality can be figured out.

## Requirements

The following section defines the requirements, describes them and gives example ways to fulfill them.

### Access to iframe context

There are many ways to access functions that are defined in an iframe.

#### Accessing from dev tools

The easiest and most convenient method for testing purposes is simply going into browser dev tools and selecting the iframe from a dropdown.

![Context selection](misc/js_console.jpg?raw=true "Context selection")

To test out if you have successfully selected the iframe as the context type out 

```javascript
console.log(quizTemplates);
```

into the console to access an iframe object. If it returns a populated object, congrats, you are in!

#### Accessing from code

If you want to make an app that uses JS to programmatically do something, you won't be able to access iframe through dev tools, but you can do it using the JS `document` api. In your code or in console get the iframe context using the following line:

```javascript
let iframeContext = document.getElementById("mauthor-iframe").contentWindow;
```

After creating this iframe "context" variable you will have to use it to access functions or variables in defined in the iframe. For example accessing the `quizTemplates` variable would look like this:

```javascript
console.log(iframeContext.quizTemplates);
```

### Function and variable names

In order to exploit some functionality of these functions or variables you have to know their names. While there are a lot of them I will provide info on some that I know and have reverse-engineered.

#### quizTemplates

Probably the most important object, has a lot of variables and functions associated with the current quiz. You will most likely be accessing stuff trough this object, for example:

```javascript
console.log(iframeContext.quizTemplates.state);
```

Will spit out the score and maxScore of each question in current quiz.

`mAuthorCheck()` function will forcibly update the `quizTemplates.state` without needing to refresh the page:

```javascript
iframeContext.quizTemplates.mAuthorCheck(false)
```

All of the functions (there's a lot) and variables that are part of `quizTemplates` object are stored in [quizTemplates.js](quizTempaltes.js) file.

#### Other functions

There are quite a few other functions that don't require quizTemplates object to access, they can simply be accessed from mauthor "context" like this:

```javascript
iframeContext.reloadPage();
```

All of the unobscured functions that I have found are stored in [otherFunction.js](otherFunction.js) file.

## Example of exploit

A chrome extension that I have created uses this exploit by injecting it's own JS into the page source code. The JS then takes advantage of this exploit and gathers test scores real time, you can read more about it [here](https://github.com/Adomas-Alimas/EdukaScores).
